---
import Base from "../../layouts/Base.astro";
import { blogPosts } from "../../data/blogData.js";
import Breadcrumbs from "../../components/blog/Breadcrumbs.astro";

export async function getStaticPaths() {
  return blogPosts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;

// تصفية المقالات ذات الصلة
const relatedPosts = blogPosts.filter((p) => p.slug !== post.slug).slice(0, 2);
---

<Base title={post.title}>
  <article class="max-w-4xl mx-auto px-6 py-20" dir="rtl">
    <Breadcrumbs
      items={[
        { label: "الرئيسية", href: "/" },
        { label: "المقالات", href: "/blog" },
        { label: post.title },
      ]}
    />

    <img
      src={post.image}
      alt={post.title}
      class="w-full h-96 object-cover rounded-2xl shadow mb-8"
    />

    <h1 class="text-3xl md:text-4xl font-bold text-[#2F855A] mb-4 text-right">
      {post.title}
    </h1>

    <p class="text-gray-500 text-sm mb-8 text-right">
      {post.date} • د. بهلولي
    </p>

    <div
      class="prose prose-lg max-w-none text-gray-800 text-right leading-relaxed"
      set:html={post.content}
    />

    <a
      href="/blog"
      class="inline-block my-8 px-8 py-3 bg-[#2F855A] text-white rounded-full hover:bg-[#096939] transition font-bold"
    >
      العودة للمقالات
    </a>

    {
      relatedPosts.length > 0 && (
        <section class="mt-12 border-t pt-10">
          <h2 class="text-2xl md:text-3xl font-bold text-[#2F855A] mb-8 text-right">
            مقالات قد تهمك
          </h2>

          <div class="grid gap-6 md:grid-cols-2">
            {relatedPosts.map((p) => (
              <article class="bg-white rounded-2xl shadow-md overflow-hidden hover:shadow-lg transition flex flex-col">
                <a href={`/blog/${p.slug}`} class="block">
                  <img
                    src={p.image}
                    alt={p.title}
                    class="w-full h-48 object-cover"
                  />
                </a>
                <div class="p-5 flex flex-col flex-grow text-right">
                  <h3 class="text-lg font-bold text-[#2F855A] mb-3">
                    <a href={`/blog/${p.slug}`} class="hover:underline">
                      {p.title}
                    </a>
                  </h3>
                  <p class="text-gray-600 text-sm line-clamp-2 mb-4">{p.description}</p>
                </div>
              </article>
            ))}
          </div>
        </section>
      )
    }
  </article>
</Base>
